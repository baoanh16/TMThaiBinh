var map,geocoder,image,shadow,currCulture,region="vn",markers=new Array,distancenode="",distancecode=0,themiles="",thekm="",arr=new Array,totalrec=0,iconUrl="/Data/Sites/1/media/default/map-icon.png",shadowUrl="/Data/Sites/1/skins/default/images/map-shadow.png",zoomInit=6,zoom=12,latInit=16.80299561823568,lngInit=107.08573669062503,lang={};function initmap(){if($("#map_canvas").length){geocoder=new google.maps.Geocoder;var e=new google.maps.LatLng(latInit,lngInit),t={zoom:zoomInit,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map_canvas"),t),$("#map_canvas").show()}}function get_coordinate(e,t){null!=t&&""!=t&&"undefined"!=t||(t="vn"),""!=e&&geocoder.geocode({address:e,region:t},function(e,t){if(t==google.maps.GeocoderStatus.OK){$("#latitude").val(e[0].geometry.location.lat()),$("#longitude").val(e[0].geometry.location.lng()),map.setZoom(15),map.setCenter(e[0].geometry.location);new google.maps.Marker({map:map,position:e[0].geometry.location})}})}function gmap_location_lookup(e,a,t,n,i){null!=t&&""!=t||(t="vn"),distancecode=1,""!=e?($("#map_canvas").html("<img src='/Data/SiteImages/indicators/indicator1.gif' alt='Ajax Loading Image' />").show(),(geocoder=new google.maps.Geocoder).geocode({address:e,region:t},function(e,t){if(t==google.maps.GeocoderStatus.OK){lat=e[0].geometry.location.lat(),lng=e[0].geometry.location.lng(),myOptions={zoom:zoom,center:new google.maps.LatLng(lat,lng),mapTypeId:google.maps.MapTypeId.ROADMAP},null!=n&&null!=i&&(myOptions={zoom:zoom,center:new google.maps.LatLng(n,i),mapTypeId:google.maps.MapTypeId.ROADMAP}),map=new google.maps.Map(document.getElementById("map_canvas"),myOptions);var r={coord:[31,0,32,1,33,2,33,3,33,4,33,5,33,6,33,7,33,8,33,9,33,10,33,11,33,12,33,13,33,14,33,15,33,16,33,17,33,18,33,19,33,20,33,21,33,22,33,23,33,24,33,25,33,26,33,27,33,28,33,29,33,30,33,31,33,32,32,33,31,34,29,35,26,36,25,37,25,38,24,39,23,40,23,41,22,42,22,43,21,44,20,45,16,45,15,44,14,43,14,42,13,41,13,40,12,39,12,38,11,37,10,36,6,35,4,34,3,33,2,32,1,31,1,30,0,29,0,28,0,27,0,26,0,25,0,24,0,23,0,22,0,21,0,20,0,19,0,18,0,17,0,16,0,15,0,14,0,13,0,12,0,11,0,10,0,9,0,8,0,7,0,6,0,5,1,4,1,3,2,2,3,1,4,0,31,0],type:"poly"};jQuery.each(markers,function(e,t){t.setMap(null)}),$("#list").empty();var s=0;$.ajax({url:"/DealerLocator/Services/GetDealerXml.ashx",dataType:"xml",type:"GET",data:{distance:a,lat:lat,lng:lng,languageid:$("#hdnDealerLocatorLanguageId").val(),siteid:$("#hdnDealerLocatorSiteId").val(),zoneguid:$("#hdnDealerLocatorZoneGuid").val(),country:$("#ddlCountry").val(),province:$("#ddlProvince").val(),district:$("#ddlDistrict").val()},success:function(e){var t=e.documentElement.getElementsByTagName("marker");if(0<t.length){totalrec=t.length;var l=new google.maps.InfoWindow({maxWidth:"400",content:""});$i=0,jQuery.each(t,function(e,t){var a=new google.maps.Marker({__gm_id:$i++,map:map,position:new google.maps.LatLng(t.getAttribute("lat"),t.getAttribute("lng")),icon:iconUrl,shadow:shadow,shape:r,title:t.getAttribute("name")+" : "+t.getAttribute("address")});origin=new google.maps.LatLng(lat,lng),dest=new google.maps.LatLng(t.getAttribute("lat"),t.getAttribute("lng")),themiles="miles",thekm="km",(new google.maps.DistanceMatrixService).getDistanceMatrix({origins:[origin],destinations:[dest],travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC,avoidHighways:!1,avoidTolls:!1},callback),markers.push(a);var n=info_window_content(t);if(i="",null!=t.getAttribute("cat_img"))var i='<img src="'+t.getAttribute("cat_img")+'" style="max-width:15px; max-height:15px;" />';s++;var o="";""!=t.getAttribute("phone")&&(o+="<div class='phone'><span>"+lang[currCulture].phone+":</span> "+t.getAttribute("phone")+"</div>"),""!=t.getAttribute("fax")&&(o+="<div><span>Fax:</span> "+t.getAttribute("fax")+"</div>"),""!=t.getAttribute("des")&&(o+="<div><span>Giờ làm việc:</span> "+t.getAttribute("des")+"</div>"),9<s?$("<div class='col-md-6 col-lg-4'  id='l_"+a.__gm_id+"'>").html("<div class='item' data-mh='my-group'><div class='title'><h2>"+lang[currCulture].name+t.getAttribute("name")+"</h2><div><span>"+lang[currCulture].address+":</span> "+t.getAttribute("address")+"</div>"+o+"<div id=d_"+s+" class='distance'><span id='disval' attr-dist='"+distancenode+"' class='value'>"+distancenode+"</span> <span class='units'></span> <span class='time2'></span></div></div><div class='products'>"+i+"</div></div>").click(function(){l.setContent(n),l.open(map,a),toggleBounce(a),zoomHere(a.getPosition().lat(),a.getPosition().lng()),$(".btn-mapmenu").trigger("click")}).appendTo("#list"):$("<div class='col-md-6 col-lg-4 clinic_list'  id='l_"+a.__gm_id+"' >").html("<div class='item'  data-mh='my-group'><div class='title'><h2>"+lang[currCulture].name+t.getAttribute("name")+"</h2><div><span>"+lang[currCulture].address+":</span> "+t.getAttribute("address")+"</div>"+o+"<div id=d_"+s+" class='distance'><span id='disval' attr-dist='"+distancenode+"' class='value'>"+distancenode+"</span> <span class='units'></span> <span class='time2'></span></div></div><div class='products'>"+i+"</div><a id='la_"+a.__gm_id+"' name='la_"+a.__gm_id+"'></a></div>").click(function(){l.setContent(n),l.open(map,a),toggleBounce(a),zoomHere(a.getPosition().lat(),a.getPosition().lng()),$(".btn-mapmenu").trigger("click")}).appendTo("#list"),google.maps.event.addListener(a,"click",function(){$("#list .clinic_list .item.active").removeClass("active"),$("#list").animate($("#l_"+a.__gm_id)[0].scrollIntoView(!0)),$("#l_"+a.__gm_id).parent().find("item").addClass("active"),toggleBounce(a),l.setContent(n),l.open(map,a)})}),$(".clinic_list").click(function(){$("#list .clinic_list .item").removeClass("active"),$(this).find(".item").addClass("active"),$('div[title="Exit Street View"]').trigger("click")})}else initmap()}})}})):gmap_province_lookup(a,t,n,i)}function gmap_province_lookup(e,t,r,s){$("#map_canvas").html("<img src='/Data/SiteImages/indicators/indicator1.gif' alt='Ajax Loading Image' />").show();var d={coord:[31,0,32,1,33,2,33,3,33,4,33,5,33,6,33,7,33,8,33,9,33,10,33,11,33,12,33,13,33,14,33,15,33,16,33,17,33,18,33,19,33,20,33,21,33,22,33,23,33,24,33,25,33,26,33,27,33,28,33,29,33,30,33,31,33,32,32,33,31,34,29,35,26,36,25,37,25,38,24,39,23,40,23,41,22,42,22,43,21,44,20,45,16,45,15,44,14,43,14,42,13,41,13,40,12,39,12,38,11,37,10,36,6,35,4,34,3,33,2,32,1,31,1,30,0,29,0,28,0,27,0,26,0,25,0,24,0,23,0,22,0,21,0,20,0,19,0,18,0,17,0,16,0,15,0,14,0,13,0,12,0,11,0,10,0,9,0,8,0,7,0,6,0,5,1,4,1,3,2,2,3,1,4,0,31,0],type:"poly"};jQuery.each(markers,function(e,t){t.setMap(null)}),$("#list").empty();var a=$("#hdnDealerLocatorZoneGuid").val(),n=zoom,c=0;$.ajax({url:"/DealerLocator/Services/GetDealerXml.ashx",dataType:"xml",type:"GET",data:{distance:e,lat:r,lng:s,languageid:$("#hdnDealerLocatorLanguageId").val(),siteid:$("#hdnDealerLocatorSiteId").val(),zoneguid:a,country:$("#ddlCountry").val(),province:$("#ddlProvince").val(),district:$("#ddlDistrict").val()},success:function(e){var t=e.documentElement.getElementsByTagName("marker");if(0<t.length){totalrec=t.length;var l=new google.maps.InfoWindow({maxWidth:"400",content:""});myOptions={zoom:n,center:new google.maps.LatLng(t[0].getAttribute("lat"),t[0].getAttribute("lng")),mapTypeId:google.maps.MapTypeId.ROADMAP},null!=r&&null!=s&&(myOptions={zoom:n,center:new google.maps.LatLng(r,s),mapTypeId:google.maps.MapTypeId.ROADMAP}),map=new google.maps.Map(document.getElementById("map_canvas"),myOptions),$i=0,jQuery.each(t,function(e,t){var a=new google.maps.Marker({__gm_id:$i++,map:map,position:new google.maps.LatLng(t.getAttribute("lat"),t.getAttribute("lng")),icon:iconUrl,shadow:shadow,shape:d,title:t.getAttribute("name")+" : "+t.getAttribute("address")});0<r&&0<s&&(origin=new google.maps.LatLng(r,s),dest=new google.maps.LatLng(t.getAttribute("lat"),t.getAttribute("lng")),themiles="miles",thekm="km",(new google.maps.DistanceMatrixService).getDistanceMatrix({origins:[origin],destinations:[dest],travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC,avoidHighways:!1,avoidTolls:!1},callback));console.log(t),markers.push(a);var n=info_window_content(t);if("",null!=t.getAttribute("cat_img"))t.getAttribute("cat_img");if(9<++c){var i="<div class='item double-digit'  data-mh='my-group'><h2>"+lang[currCulture].name+t.getAttribute("name")+"</h2>";i+="<div class='des'><ul>",""!=t.getAttribute("des")&&""!=t.getAttribute("address")&&(i+="<li><a target='_blank'  href='"+t.getAttribute("des")+"' ><i class='lnr lnr-map-marker'></i> "+t.getAttribute("address")+"</a></li>"),""!=t.getAttribute("phone")&&(i+="<li><i class='lnr lnr-phone-handset'></i>"+t.getAttribute("phone")+"</li>"),""!=t.getAttribute("fax")&&(i+="<li><i class='lnr lnr-phone'></i>"+t.getAttribute("fax")+" </li>"),i+="</ul></div>",$("<div class='col-md-6 col-lg-4 clinic_list' id='l_"+a.__gm_id+"'>").html(i).click(function(){l.setContent(n),l.open(map,a),toggleBounce(a),zoomHere(a.getPosition().lat(),a.getPosition().lng()),$(".btn-mapmenu").trigger("click")}).appendTo("#list")}else{var o="<div class='item double-digit'  data-mh='my-group'>";""!=t.getAttribute("name")&&(o+="<h2>"+lang[currCulture].name+t.getAttribute("name")+"</h2>"),o+="<div class='des'><ul>",""!=t.getAttribute("des")&&(o+="<li><a target='_blank' href='"+t.getAttribute("des")+"' ><i class='lnr lnr-map-marker'></i> "+t.getAttribute("address")+"</a></li>"),""!=t.getAttribute("phone")&&(o+="<li><i class='lnr lnr-phone-handset'></i>"+t.getAttribute("phone")+"</li>"),""!=t.getAttribute("fax")&&(o+="<li><i class='lnr lnr-phone'></i>"+t.getAttribute("fax")+" </li>"),o+="</ul></div>",$("<div class='col-md-6 col-lg-4 clinic_list' id='l_"+a.__gm_id+"'>").html(o).click(function(){l.setContent(n),l.open(map,a),toggleBounce(a),zoomHere(a.getPosition().lat(),a.getPosition().lng()),$(".btn-mapmenu").trigger("click")}).appendTo("#list")}google.maps.event.addListener(a,"click",function(){$("#list .clinic_list .item.active").removeClass("active"),$("#list").animate($("#l_"+a.__gm_id)[0].scrollIntoView(!0)),$("#l_"+a.__gm_id).find(".item").addClass("active"),toggleBounce(a),l.setContent(n),l.open(map,a),map.setZoom(15)})}),$(".clinic_list").click(function(){$("#list .clinic_list .item.active").removeClass("active"),$(this).find(".item").addClass("active"),console.log(this),$('div[title="Exit Street View"]').trigger("click")})}else initmap()}})}function sort_distance(){var a=1,e=$("#list li").get();e.sort(function(e,t){var a=$(e).find("#disval").text(),n=$(t).find("#disval").text();return Math.round(100*parseFloat(a))/100<Math.round(100*parseFloat(n))/100?-1:Math.round(100*parseFloat(a))/100>Math.round(100*parseFloat(n))/100?1:0});var n=$("#list");$.each(e,function(e,t){n.append(t),$("#"+$(t).attr("id")+" .number").text(a),a++})}function toggleBounce(a){$(markers).each(function(e,t){a.__gm_id!=t.__gm_id&&t.setAnimation(null)}),null!=a.getAnimation()?a.setAnimation(null):a.setAnimation(google.maps.Animation.BOUNCE)}function callback(e,t){if(t==google.maps.DistanceMatrixStatus.OK){for(var a=e.originAddresses,n=e.destinationAddresses,i=0;i<a.length;i++)for(var o=e.rows[i].elements,l=0;l<o.length;l++){var r=o[l];if(null!=r){var s=(parseFloat(r.distance.value)/1e3).toFixed(1),d="";d="kms"==$("input[name=distance-units]:checked").val()?themiles:thekm;r.duration.text,a[i],n[l];arr.push(s)}}if(++distancecode==totalrec+1){for(distancecode=0,arr.sort(function(e,t){return e-t}),k=0;k<=arr.length;k++)$("#d_"+(k+1)+" .value").html(arr[k]),$("#d_"+(k+1)+" .units").html(d);arr=[]}}}function changeDistanceUnits(e){var a=.621371192237334,t=$("#results"),n=t.find("p.distance-units label"),i=t.find(".distance"),o=i.find(".units");i.find(".value");switch(n.removeClass("unchecked"),n.filter(':not([units="'+e+'"])').addClass("unchecked"),e){case"km":o.html(" "+thekm+" "),$.each(i,function(e,t){e++,t=$("#d_"+e+" .value").html(),t=parseFloat(t),$("#d_"+e+" .value").text(Math.round(t/a*100)/100)});break;case"miles":o.html(" "+themiles+" "),$.each(i,function(e,t){e++,t=$("#d_"+e+" .value").html(),t=parseFloat(t),$("#d_"+e+" .value").text(Math.round(t*a*100)/100)})}}function info_window_content(e){var t="<div class='maps_popup'>";return t+="<h1>"+lang[currCulture].name+e.getAttribute("name")+"</h1>",null!=e.getAttribute("address")&&""!=e.getAttribute("address")&&(t+="<p class='address'><span>"+lang[currCulture].address+":</span> "+e.getAttribute("address")+"</p>"),null!=e.getAttribute("phone")&&""!=e.getAttribute("phone")&&(t+="<p class='tel'><span>"+lang[currCulture].phone+":</span> "+e.getAttribute("phone")+"</p>"),null!=e.getAttribute("fax")&&""!=e.getAttribute("fax")&&(t+="<p class='fax'><span>Fax:</span> "+e.getAttribute("fax")+"</p>"),null!=e.getAttribute("email")&&""!=e.getAttribute("email")&&(t+="<p class='email'><span>Email:</span> <a href='mailto:"+e.getAttribute("email")+"'>"+e.getAttribute("email")+"</a></p>"),null!=e.getAttribute("website")&&""!=e.getAttribute("website")&&("http"!=e.getAttribute("website").substring(0,4)?t+="<p class='web'><span>Website:</span> <a href='http://"+e.getAttribute("website")+"' target='new'>http://"+e.getAttribute("website")+"</a></p>":t+="<p class='web'><span>Website:</span> <a href='"+e.getAttribute("website")+"' target='new'>"+e.getAttribute("website")+"</a></p>"),t+="<a href='javascript:zoomHere("+e.getAttribute("lat")+","+e.getAttribute("lng")+");'>"+lang[currCulture].zoom+"</a> ",t+="</div>"}function streetView(e,t){street=new google.maps.StreetViewPanorama(document.getElementById("map_canvas"),{position:new google.maps.LatLng(e,t),zoomControl:!1,enableCloseButton:!0,addressControl:!1,panControl:!0,linksControl:!0})}function zoomHere(e,t){map.setZoom(18);var a=new google.maps.LatLng(e,t);map.setCenter(a)}function direction(o,l,r){$("#direction").show(),$("#results").hide(),$("#dest-direction").val(o),$("#origin-direction").val($("#address").val()),$("#get-direction").click(function(){var e=$("#origin-direction").val();console.log(1),map.setZoom(7);var t=new google.maps.LatLng(l,r);map.setCenter(t);var a=new google.maps.DirectionsRenderer;a.setMap(map),a.setPanel(document.getElementById("direction"));var n=new google.maps.DirectionsService,i={origin:e,destination:o,travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:google.maps.DirectionsUnitSystem.METRIC};return n.route(i,function(e,t){t==google.maps.DirectionsStatus.OK?a.setDirections(e):$("#direction").append('<table width="100%"><tr><td>'+lang[currCulture].directionNotFound+"</td></tr></table>")}),!1})}function directionBack(){$("#direction").hide(),$("#results").show(),resetDirection()}function resetDirection(){gmap_location_lookup($("#address").val(),$("#distance").val(),""),$("#direction").html(""),$("#direction").html('<div id="direction-form"><p><table><tr><td>'+lang[currCulture].from+':</td><td><input id="origin-direction" name="origin-direction" class="orides-txt" type=text /></td></tr><tr><td>'+lang[currCulture].to+':</td><td><input id="dest-direction" name="dest-direction" class="orides-txt" type=text readonly /></td></tr></table><div id="get-dir-button" class="get-dir-button"><input type=submit id="get-direction" class="btn" value="'+lang[currCulture].direction+'"> <a href="javascript:directionBack()">'+lang[currCulture].back+"</a></div></p></div>");new google.maps.places.Autocomplete($("#origin-direction")[0],{})}lang.en={name:"",searchResultName:"",fax:"Fax",phoneMaintenance:"Maintenance",hotline:"Hotline",phone:"Phone",address:"Address",zoom:"Zoom",direction:"Direction",directionNotFound:"Direction not found. Please try again",notFound:"No results ",found:"Found ",locations:" ",matchYourSearch:" match your search",nearYourLocation:" near your location",from:"From",to:"To",back:"Back",moblie:"Hotline"},lang.vi={name:"",searchResultName:"",fax:"Fax",phoneMaintenance:"Bảo trì sữa chữa",hotline:"Hotline",phone:"Điện thoại",address:"Địa chỉ",zoom:"Phóng to",direction:"Tìm đường đi",directionNotFound:"Không tìm thấy đường đi. Vui lòng thử lại",notFound:"Không tìm thấy địa điểm ",found:"Có ",locations:" ",matchYourSearch:" phù hợp với tìm kiếm của bạn",nearYourLocation:" gần với vị trí của bạn",from:"Từ",to:"Đến",back:"Trở lại",moblie:"Hotline"},$(document).ready(function(){setTimeout(function(){$("#ddlCountry").val("99f791e7-7343-42e8-8c19-3c41068b5f8d").trigger("change")},1e3),currCulture=$("#hdfDealerLocatorCulture").val(),image=new google.maps.MarkerImage(iconUrl,new google.maps.Size(34,46),new google.maps.Point(0,0),new google.maps.Point(17,46)),shadow=new google.maps.MarkerImage(shadowUrl,new google.maps.Size(60,46),new google.maps.Point(0,0),new google.maps.Point(17,46)),$("p.distance-units label input:radio").click(function(){var e=$(this).parents("label").attr("units");$(this).parents("label").hasClass("unchecked")&&changeDistanceUnits(e)}),initmap();new google.maps.places.Autocomplete($("#address")[0],{}),new google.maps.places.Autocomplete($("#origin-direction")[0],{});if($("#edit-submit").length&&$("#edit-submit").click(function(){return gmap_location_lookup($("#address").val(),$("#distance").val(),region),!1}),$("#ddlProvince").length&&($.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/DealerLocator/Services/GeoZoneService.asmx/LoadCountry",data:"{'languageId': '"+$("#hdnDealerLocatorLanguageId").val()+"'}",dataType:"json",success:function(e){var a=$("#ddlCountry");$(a).empty(),$(a).append($("<option></option>").val("").html($("#hdfDealerLocatorSelectCountry").val())),$.each(e.d,function(e,t){$(a).append($("<option></option>").val(t.Key).html(t.Name))}),2==a.find("option").length&&(a.addClass("hidden"),a.find("option").eq(1).prop("selected",!0),$("#ddlCountry").trigger("change"))},error:function(e){}}),$("#ddlCountry").change(function(){$.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/DealerLocator/Services/GeoZoneService.asmx/LoadProvince",data:"{'languageId': '"+$("#hdnDealerLocatorLanguageId").val()+"', 'countryGuid': '"+$("#ddlCountry").val()+"'}",dataType:"json",success:function(e){var a=$("#ddlProvince");$(a).empty(),$(a).append($("<option></option>").val("").html($("#hdfDealerLocatorSelectProvince").val())),$.each(e.d,function(e,t){$(a).append($("<option></option>").val(t.Key).html(t.Name))})},error:function(e){}})}),$("#ddlDistrict").length&&$("#ddlProvince").change(function(){$.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/DealerLocator/Services/GeoZoneService.asmx/LoadDistrict",data:"{'languageId': '"+$("#hdnDealerLocatorLanguageId").val()+"', 'provinceGuid': '"+$("#ddlProvince").val()+"'}",dataType:"json",success:function(e){var a=$("#ddlDistrict");$(a).empty(),$(a).append($("<option></option>").val("").html($("#hdfDealerLocatorSelectDistrict").val())),$.each(e.d,function(e,t){$(a).append($("<option></option>").val(t.Key).html(t.Name))}),$("#edit-submit").trigger("click")},error:function(e){}})})),$("#ddlDistrict").change(function(){$("#edit-submit").trigger("click")}),$("#add #map_canvas").length){var e=10.8230989,a=106.6296638,n=!1;$("#latitude").length&&(val=1*$("#latitude").val(),""==val||isNaN(val)||(e=val,n=!0)),$("#longitude").length&&(val=1*$("#longitude").val(),""==val||isNaN(val)||(a=val)),geocoder=new google.maps.Geocoder;var i=new google.maps.LatLng(e,a),o={zoom:zoom,center:i,mapTypeId:google.maps.MapTypeId.ROADMAP};if(map=new google.maps.Map(document.getElementById("map_canvas"),o),n)new google.maps.Marker({map:map,position:i})}$("#add #address").length&&$("#add #address").blur(function(){var e=$(this).val();""!=e&&get_coordinate(e,region)}),t=window.setInterval(function(){var e=zoom;zoom=zoomInit,gmap_location_lookup("",$("#distance").val()+1e5,region,latInit,lngInit),zoom=e,window.clearInterval(t)},100)});
